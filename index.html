<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<title>å­¦ã³ã®æ£®ï½œãƒ©ãƒ³ãƒ€ãƒ æ–‡ç« é¡Œ & è¨ˆç®—</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
:root{--brand:#2563eb;--ink:#0f172a;--muted:#64748b;--line:#e2e8f0;--bg:#f8fafc;--card:#fff;--accent:#f1f5f9}
*{box-sizing:border-box} body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN","Meiryo",sans-serif;color:var(--ink);background:var(--bg);margin:0}
.wrap{max-width:980px;margin:0 auto;padding:16px}
h1{margin:18px 0 6px;font-size:clamp(22px,3.6vw,32px)} .lead{color:var(--muted);margin:0 0 18px}
.panel{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:14px;margin:14px 0}
.card{border:1px solid var(--line);border-radius:14px;background:#fff;padding:14px}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
@media (max-width:820px){ .grid2{grid-template-columns:1fr} }
h2{margin:6px 0 8px;font-size:20px}
.sub{color:var(--muted);margin:0 0 10px}
.btn{background:var(--brand);color:#fff;border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
.btn.sm{padding:6px 10px;border-radius:8px;font-weight:600}
.btn.ghost{background:#fff;color:var(--brand);border:1px solid var(--brand)}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.small{font-size:12px;color:var(--muted)}
.hr{height:1px;background:var(--line);margin:10px 0}
.accordion{border:1px solid var(--line);border-radius:12px;overflow:hidden}
.acc-hd{background:var(--accent);padding:10px 12px;cursor:pointer;font-weight:700}
.acc-bd{display:none;padding:12px;background:#fff}
.acc.open .acc-bd{display:block}
select,input[type="number"]{border:1px solid var(--line);border-radius:8px;padding:6px 8px}
#problems .q{border-bottom:1px solid var(--line);padding:10px 2px}
.answer{width:160px;padding:6px 8px;border:1px solid var(--line);border-radius:8px}
.badge{display:inline-block;background:#eef2ff;color:#3730a3;border:1px solid #c7d2fe;border-radius:999px;padding:2px 8px;font-size:12px;font-weight:700}
</style>
</head>
<body>
<div class="wrap">
  <h1>æœ¬å½“ã«å­¦åŠ›ãŒã¤ããƒ‰ãƒªãƒ«ã€‚</h1>
  <p class="lead">æ–‡ç« é¡Œã¯ã€Œã“ã“ã¾ã§ç¿’ã£ãŸç¯„å›²ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã€ã€‚è¨ˆç®—ã¯ã€Œæ¨ªæ–­ãƒ©ãƒ³ãƒ€ãƒ ã€ã¨ã€Œå˜å…ƒå†…ãƒ©ãƒ³ãƒ€ãƒ ã€ã€‚</p>

  <div class="grid2">
    <!-- æ–‡ç« é¡Œ -->
    <section class="card">
      <h2>ğŸ“˜ æ–‡ç« é¡Œ</h2>
      <p class="sub">èª­ã‚€åŠ›ãƒ»è€ƒãˆã‚‹åŠ›ã‚’è‚²ã¦ã‚‹ã€ã‚µãƒ¼ãƒ“ã‚¹ã®çœ‹æ¿æ©Ÿèƒ½ã€‚</p>
      <div class="row">
        <button class="btn" onclick="startWordRandom()">ãƒ©ãƒ³ãƒ€ãƒ ã«å‡ºé¡Œï¼ˆãŠã™ã™ã‚ï¼‰</button>
        <button class="btn ghost" onclick="toggle('acc-word')">ä»–ã®å‡ºé¡Œ</button>
      </div>
      <div id="acc-word" class="accordion acc" style="margin-top:10px">
        <div class="acc-hd" onclick="toggle('acc-word')">å­¦å¹´ï¼å˜å…ƒã§å‡ºé¡Œ</div>
        <div class="acc-bd">
          <div class="row">
            <label>å­¦å¹´
              <select id="grade-word">
                <option value="">æŒ‡å®šãªã—</option>
                <option>2</option><option>3</option><option>4</option>
              </select>
            </label>
            <label>å˜å…ƒï¼ˆä»»æ„ï¼‰
              <select id="unit-word">
                <option value="">æŒ‡å®šãªã—</option>
                <option value="MIX">è¤‡åˆ</option>
                <option value="SPEED">é€Ÿã•</option>
                <option value="RATE">å‰²åˆ</option>
                <option value="FRAC">åˆ†æ•°</option>
              </select>
            </label>
            <label>å‡ºé¡Œæ•° <input type="number" id="n-word" value="5" min="1" max="20"></label>
            <button class="btn sm" onclick="startWordByFilters()">ã“ã®æ¡ä»¶ã§å‡ºé¡Œ</button>
          </div>
          <p class="small">â€» å¾Œæ—¥ã€æ•™ç§‘æ›¸ä¼šç¤¾ã”ã¨ã®é…åˆ—ã«ã‚‚å¯¾å¿œäºˆå®šã€‚</p>
        </div>
      </div>
    </section>

    <!-- è¨ˆç®— -->
    <section class="card">
      <h2>ğŸ§® è¨ˆç®—</h2>
      <p class="sub">ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å£ã‚’è¶Šãˆã¦ã€å¿…è¦ãªç·´ç¿’ã‚’ã¾ã¨ã‚ã¦ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã€‚</p>

      <div class="accordion acc open" id="acc-calc-cross">
        <div class="acc-hd" onclick="toggle('acc-calc-cross')">æ¨ªæ–­ãƒ©ãƒ³ãƒ€ãƒ ï¼ˆãŠã™ã™ã‚ï¼‰</div>
        <div class="acc-bd">
          <div class="row">
            <span class="badge">å››å‰‡ã”ã¡ã‚ƒæ··ãœ</span>
            <label>å‡ºé¡Œæ•° <input type="number" id="n-calc-cross" value="10" min="1" max="30"></label>
            <button class="btn sm" onclick="startCalcCross()">å‡ºé¡Œ</button>
          </div>
          <p class="small">ç¹°ã‚Šä¸ŠãŒã‚Šãƒ»ç¹°ä¸‹ãŒã‚Šãƒ»å•†ã®ä½ãƒ»ä½™ã‚Š ãªã©ã‚’æ¨ªæ–­çš„ã«å‡ºã—ã¾ã™ã€‚</p>
        </div>
      </div>

      <div class="accordion acc" id="acc-calc-unit" style="margin-top:10px">
        <div class="acc-hd" onclick="toggle('acc-calc-unit')">å˜å…ƒå†…ãƒ©ãƒ³ãƒ€ãƒ </div>
        <div class="acc-bd">
          <div class="row">
            <label>ç¨®åˆ¥
              <select id="calc-kind">
                <option value="add">è¶³ã—ç®—</option>
                <option value="sub">å¼•ãç®—</option>
                <option value="mul">ã‹ã‘ç®—</option>
                <option value="div">ã‚ã‚Šç®—</option>
              </select>
            </label>
            <span id="calc-options"></span>
            <label>å‡ºé¡Œæ•° <input type="number" id="n-calc-unit" value="10" min="1" max="30"></label>
            <button class="btn sm" onclick="startCalcUnit()">å‡ºé¡Œ</button>
          </div>
          <p class="small">ä¾‹ï¼‰ã‚ã‚Šç®—ã®ç­†ç®—ï¼šå•†ã®ä½ã‚„ä½™ã‚Šã®æœ‰ç„¡ã‚’ã¾ãŸã„ã§ãƒ©ãƒ³ãƒ€ãƒ ã«ã€‚</p>
        </div>
      </div>
    </section>
  </div>

  <section id="play" class="panel" style="display:none">
    <div class="row" style="justify-content:space-between">
      <div><strong id="mode-label">å‡ºé¡Œ</strong></div>
      <div class="row">
        <button class="btn ghost sm" onclick="window.print()">PDFï¼ˆå°åˆ·ï¼‰</button>
        <button class="btn ghost sm" onclick="resetAnswers()">å›ç­”ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
      </div>
    </div>
    <div id="problems"></div>
  </section>

  <p class="small">â€» ãƒ‡ãƒ¼ã‚¿ã¯æœ€å°ã‚»ãƒƒãƒˆã§å‹•ä½œã€‚å¾Œã§ <code>/app/problems.json</code> ã«æ¥ç¶šå¯èƒ½ã€‚</p>
</div>

<script>
/* â”€â”€ ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function toggle(id){ const el=document.getElementById(id); el.classList.toggle('open'); }
const rnd = (a,b)=> Math.floor(Math.random()*(b-a+1))+a;

/* å‡ºé¡Œãƒãƒƒãƒ•ã‚¡ */
let CURRENT=[];

/* â”€â”€ æ–‡ç« é¡Œï¼ˆæœ€å°ãƒ‡ãƒ¼ã‚¿ï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const WORD_POOL = [
  {id:'Q-03-MIX-001-v1',grade:'3',unit:'MIX',text:'ã‚Šã‚“ã”ãŒ3ã“ã‚ã‚Šã¾ã™ã€‚ã•ã‚‰ã«4ã“ã‚‚ã‚‰ã„ã¾ã—ãŸã€‚ãœã‚“ã¶ã§ä½•ã“ï¼Ÿ',answer:'7'},
  {id:'Q-03-SPEED-012-v1',grade:'3',unit:'SPEED',text:'å®¶ã‹ã‚‰å­¦æ ¡ã¾ã§1.2kmã€‚æ¯åˆ†80mã§æ­©ãã¨ä½•åˆ†ï¼Ÿ',answer:'15'},
  {id:'Q-04-RATE-021-v1',grade:'4',unit:'RATE',text:'ã‚ã‚‹æ•°ã®25%ã¯18ã§ã™ã€‚ã‚‚ã¨ã®æ•°ã¯ã„ãã¤ï¼Ÿ',answer:'72'},
  {id:'Q-03-FRAC-030-v1',grade:'3',unit:'FRAC',text:'ã¿ã‹ã‚“ã‚’8äººã§åŒã˜æ•°ãšã¤åˆ†ã‘ã¾ã™ã€‚1äººåˆ†ã¯ä½•ã“ï¼Ÿ',answer:'1'},
  {id:'Q-02-MIX-010-v1',grade:'2',unit:'MIX',text:'ãˆã‚“ã´ã¤ãŒ9æœ¬ã€‚3äººã«åŒã˜æœ¬æ•°ãšã¤ã‚ã‘ã‚‹ã¨1äººä½•æœ¬ï¼Ÿ',answer:'3'}
];

function pickN(arr, n){
  const src = arr.slice(); const out=[];
  while(out.length<n && src.length){ out.push(src.splice(rnd(0,src.length-1),1)[0]); }
  return out;
}

function startWordRandom(){
  const n = 5;
  const pick = pickN(WORD_POOL, n);
  showProblems(pick, 'ğŸ“˜ æ–‡ç« é¡Œï½œãƒ©ãƒ³ãƒ€ãƒ ');
}
function startWordByFilters(){
  const g = document.getElementById('grade-word').value;
  const u = document.getElementById('unit-word').value;
  const n = Math.max(1, Math.min(20, Number(document.getElementById('n-word').value||5)));
  let pool = WORD_POOL.slice();
  if(g) pool = pool.filter(p=>p.grade===g);
  if(u) pool = pool.filter(p=>p.unit===u);
  const pick = pickN(pool, n);
  showProblems(pick, 'ğŸ“˜ æ–‡ç« é¡Œï½œæ¡ä»¶å‡ºé¡Œ');
}

/* â”€â”€ è¨ˆç®—ï¼šæ¨ªæ–­ãƒ©ãƒ³ãƒ€ãƒ  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function startCalcCross(){
  const n = Math.max(1, Math.min(30, Number(document.getElementById('n-calc-cross').value||10)));
  const gen = [];
  for(let i=0;i<n;i++){
    const kind = ['add','sub','mul','div'][rnd(0,3)];
    gen.push(generateCalc(kind, {cross:true}));
  }
  showProblems(gen, 'ğŸ§® è¨ˆç®—ï½œæ¨ªæ–­ãƒ©ãƒ³ãƒ€ãƒ ');
}

/* â”€â”€ è¨ˆç®—ï¼šå˜å…ƒå†…ãƒ©ãƒ³ãƒ€ãƒ  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const UNIT_OPTION_TEMPLATES = {
  add(){ return `
    <label>æ¡ <select id="opt-digits"><option>1æ¡</option><option selected>2æ¡</option><option>3æ¡</option></select></label>
    <label>ç¹°ã‚Šä¸ŠãŒã‚Š <select id="opt-carry"><option>ä¸å•</option><option>ã‚ã‚Š</option><option>ãªã—</option></select></label>
  `},
  sub(){ return `
    <label>æ¡ <select id="opt-digits"><option>1æ¡</option><option selected>2æ¡</option><option>3æ¡</option></select></label>
    <label>ç¹°ä¸‹ãŒã‚Š <select id="opt-borrow"><option>ä¸å•</option><option>ã‚ã‚Š</option><option>ãªã—</option></select></label>
  `},
  mul(){ return `
    <label>å½¢å¼ <select id="opt-form"><option>1æ¡Ã—1æ¡</option><option selected>2æ¡Ã—1æ¡</option><option>2æ¡Ã—2æ¡</option></select></label>
  `},
  div(){ return `
    <label>å½¢å¼ <select id="opt-form"><option selected>2æ¡Ã·1æ¡</option><option>3æ¡Ã·1æ¡</option></select></label>
    <label>ä½™ã‚Š <select id="opt-rem"><option>ä¸å•</option><option>ã‚ã‚Š</option><option>ãªã—</option></select></label>
  `}
};
function renderUnitOptions(){
  const kind = document.getElementById('calc-kind').value;
  document.getElementById('calc-options').innerHTML = UNIT_OPTION_TEMPLATES[kind]();
}
function startCalcUnit(){
  const kind = document.getElementById('calc-kind').value;
  const n = Math.max(1, Math.min(30, Number(document.getElementById('n-calc-unit').value||10)));
  const opts = {};
  if(kind==='add' || kind==='sub'){ opts.digits = document.getElementById('opt-digits').value; }
  if(kind==='add'){ opts.carry = document.getElementById('opt-carry').value; }
  if(kind==='sub'){ opts.borrow = document.getElementById('opt-borrow').value; }
  if(kind==='mul' || kind==='div'){ opts.form = document.getElementById('opt-form').value; }
  if(kind==='div'){ opts.rem = document.getElementById('opt-rem').value; }

  const out=[];
  for(let i=0;i<n;i++) out.push(generateCalc(kind, opts));
  const labelMap = {add:'è¶³ã—ç®—', sub:'å¼•ãç®—', mul:'ã‹ã‘ç®—', div:'ã‚ã‚Šç®—'};
  showProblems(out, `ğŸ§® è¨ˆç®—ï½œå˜å…ƒå†…ãƒ©ãƒ³ãƒ€ãƒ ï¼ˆ${labelMap[kind]}ï¼‰`);
}

/* â”€â”€ è¨ˆç®—å•é¡Œã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ï¼ˆæœ€å°å®Ÿè£…ï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function generateCalc(kind, opts={}){
  let q='', correct='';
  if(kind==='add'){
    const d = opts.digits||['1æ¡','2æ¡','3æ¡'][rnd(0,2)];
    const base = d==='1æ¡'?9 : d==='2æ¡'?99 : 999;
    let a=rnd(1,base), b=rnd(1,base);
    if(opts.carry==='ã‚ã‚Š'){
      // æœ«ä½ã§ç¹°ã‚Šä¸ŠãŒã‚Šã‚’èµ·ã“ã—ã‚„ã™ã
      a = Math.max(1, a - (a%10)) + rnd(6,9);
      b = Math.max(1, b - (b%10)) + rnd(6,9);
    }
    if(opts.carry==='ãªã—'){
      // æœ«ä½ã®å’ŒãŒ9ä»¥ä¸‹ã«ãªã‚‹ã‚ˆã†èª¿æ•´
      const da=rnd(1,9), db=rnd(0,9-da);
      a = (a - (a%10)) + da; b = (b - (b%10)) + db;
    }
    q = `${a}ï¼‹${b} ã‚’è¨ˆç®—ã—ã¾ã—ã‚‡ã†ã€‚`; correct = String(a+b);
  }
  if(kind==='sub'){
    const d = opts.digits||['1æ¡','2æ¡','3æ¡'][rnd(0,2)];
    const base = d==='1æ¡'?9 : d==='2æ¡'?99 : 999;
    let a=rnd(1,base), b=rnd(1,base);
    if(a<b){ const t=a;a=b;b=t; }
    if(opts.borrow==='ã‚ã‚Š'){
      // æœ«ä½ã§ç¹°ä¸‹ãŒã‚ŠãŒèµ·ãã‚„ã™ã
      const da=rnd(0,8), db=rnd(da+1,9);
      a = (a - (a%10)) + da + 10; b = (b - (b%10)) + db;
    }
    if(opts.borrow==='ãªã—'){
      const da=rnd(2,9), db=rnd(0,da); // æœ«ä½ã§å€Ÿã‚Šãªã„
      a = (a - (a%10)) + da; b = (b - (b%10)) + db;
    }
    q = `${a}âˆ’${b} ã‚’è¨ˆç®—ã—ã¾ã—ã‚‡ã†ã€‚`; correct = String(a-b);
  }
  if(kind==='mul'){
    const form = opts.form||['1æ¡Ã—1æ¡','2æ¡Ã—1æ¡','2æ¡Ã—2æ¡'][rnd(0,2)];
    let a,b;
    if(form==='1æ¡Ã—1æ¡'){ a=rnd(2,9); b=rnd(2,9); }
    if(form==='2æ¡Ã—1æ¡'){ a=rnd(12,99); b=rnd(2,9); }
    if(form==='2æ¡Ã—2æ¡'){ a=rnd(12,99); b=rnd(12,99); }
    q = `${a}Ã—${b} ã‚’è¨ˆç®—ã—ã¾ã—ã‚‡ã†ã€‚`; correct = String(a*b);
  }
  if(kind==='div'){
    const form = opts.form||['2æ¡Ã·1æ¡','3æ¡Ã·1æ¡'][rnd(0,1)];
    let a,b,r=0;
    if(form==='2æ¡Ã·1æ¡'){ b=rnd(2,9); const q=rnd(2,9); a=b*q + (opts.rem==='ã‚ã‚Š'? rnd(1,b-1):0); if(opts.rem==='ãªã—') a=b*q; }
    if(form==='3æ¡Ã·1æ¡'){ b=rnd(2,9); const q=rnd(10,99); a=b*q + (opts.rem==='ã‚ã‚Š'? rnd(1,b-1):0); if(opts.rem==='ãªã—') a=b*q; }
    const divQ = Math.floor(a/b), rem = a%b;
    q = `${a}Ã·${b} ã‚’è¨ˆç®—ã—ã¾ã—ã‚‡ã†ã€‚` ;
    correct = rem? `${divQ}ã‚ã¾ã‚Š${rem}` : String(divQ);
  }
  return {id:`GEN-${kind}-${Date.now()}-${Math.random().toString(36).slice(2,6)}`, q, correct};
}

/* â”€â”€ è¡¨ç¤ºãƒ»æ¡ç‚¹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function showProblems(items, label){
  CURRENT = items.map(p => ({...p, answer:null, ok:null}));
  document.getElementById('mode-label').textContent = label;
  document.getElementById('play').style.display='block';
  renderProblems();
}
function renderProblems(){
  const box = document.getElementById('problems');
  if(!CURRENT.length){ box.innerHTML='<div class="small">ã¾ã å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>'; return; }
  box.innerHTML = CURRENT.map((it,i)=>`
    <div class="q">
      <div><strong>${i+1}. ${it.q}</strong></div>
      <div class="row" style="margin-top:6px">
        <input class="answer" placeholder="ã“ãŸãˆ" data-i="${i}">
        <button class="btn sm ghost" onclick="gradeOne(${i})">åˆ¤å®š</button>
        <span id="r${i}" class="small"></span>
      </div>
    </div>
  `).join('');
  box.querySelectorAll('.answer').forEach(inp=>{
    inp.addEventListener('keydown',e=>{ if(e.key==='Enter') gradeOne(Number(inp.dataset.i)); });
  });
}
function norm(s){ return String(s||'').trim().replace(/\s+/g,''); }
function gradeOne(i){
  const inp = document.querySelector(`.answer[data-i="${i}"]`); const a = norm(inp.value);
  const corr = norm(CURRENT[i].correct);
  // ä½™ã‚Šè¡¨è¨˜ï¼ˆ13ã‚ã¾ã‚Š4ï¼‰ã¨æ•°å€¤ä¸€è‡´ã®ä¸¡å¯¾å¿œ
  const ok = (a===corr) || (a===String(Number(corr))) ;
  CURRENT[i].ok = ok;
  const el = document.getElementById('r'+i);
  el.textContent = ok? 'â—¯ æ­£è§£ï¼':'Ã— ã‚‚ã†ä¸€åº¦';
  el.style.color = ok? '#16a34a':'#dc2626';
}
function resetAnswers(){ CURRENT.forEach(x=>{x.answer=null;x.ok=null}); renderProblems(); alert('å›ç­”ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ'); }

/* åˆæœŸåŒ–ï¼šå˜å…ƒå†…ã‚ªãƒ—ã‚·ãƒ§ãƒ³æç”» */
renderUnitOptions();
document.getElementById('calc-kind').addEventListener('change', renderUnitOptions);
</script>
</body>
</html>
