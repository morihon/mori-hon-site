<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<title>å­¦ã³ã®æ£®ï½œãƒ©ãƒ³ãƒ€ãƒ æ–‡ç« é¡Œ & è¨ˆç®—</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
:root{
  --brand:#2563eb; --ink:#0f172a; --muted:#64748b; --line:#e2e8f0;
  --bg:#f8fafc; --card:#fff; --accent:#f1f5f9; --brand-weak:#dbeafe
}
*{box-sizing:border-box} html,body{margin:0}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN","Meiryo",sans-serif;background:var(--bg);color:var(--ink)}
.wrap{max-width:1000px;margin:0 auto;padding:16px 18px}
h1{margin:10px 0 4px;font-size:clamp(22px,4.5vw,34px);letter-spacing:.02em}
.lead{margin:0 0 14px;color:var(--muted)}

.topbar{background:#fff;border:1px solid var(--line);border-radius:14px;padding:12px;margin:10px 0}
.pills{display:flex;gap:8px;flex-wrap:wrap}
.pill{border:1px solid var(--line);background:#fff;border-radius:999px;padding:8px 12px;cursor:pointer;font-weight:700}
.pill.active{border-color:var(--brand);background:var(--brand-weak);color:#1e3a8a}
.note{font-size:12px;color:var(--muted);margin-top:6px}

.tabs{display:flex;gap:8px;margin-top:10px}
.tab{flex:1;text-align:center;padding:12px;border:1px solid var(--line);background:#fff;border-radius:12px;cursor:pointer;font-weight:800}
.tab.active{border-color:var(--brand);box-shadow:0 0 0 3px rgba(37,99,235,.12)}

.panels{margin-top:12px}
.panel{display:none;background:var(--card);border:1px solid var(--line);border-radius:14px;padding:14px}
.panel.show{display:block}
h2{margin:6px 0 10px;font-size:20px}
.sub{color:var(--muted);margin:0 0 10px}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.btn{background:var(--brand);color:#fff;border:none;border-radius:12px;padding:10px 14px;font-weight:800;cursor:pointer}
.btn.ghost{background:#fff;color:var(--brand);border:1px solid var(--brand)}
.btn.sm{padding:6px 10px;border-radius:10px;font-weight:700}
select,input[type="number"]{border:1px solid var(--line);border-radius:10px;padding:8px 10px}

.accordion{border:1px solid var(--line);border-radius:12px;overflow:hidden}
.acc-hd{background:var(--accent);padding:10px 12px;cursor:pointer;font-weight:800}
.acc-bd{display:none;padding:12px;background:#fff}
.acc.open .acc-bd{display:block}

#play{margin-top:14px}
.q{border-bottom:1px solid var(--line);padding:10px 2px}
.answer{width:170px;padding:8px 10px;border:1px solid var(--line);border-radius:10px}
.badge{display:inline-block;background:#eef2ff;color:#3730a3;border:1px solid #c7d2fe;border-radius:999px;padding:2px 8px;font-size:12px;font-weight:800}

/* â†ã“ã“ã‚ˆã‚Šä¸‹ã«â€œç´°ã‹ãªæ”¹ä¿®â€ã‚’è¿½è¨˜ã—ã¦OK */
</style>
</head>
<body>
<div class="wrap">
  <h1>æœ¬å½“ã«å­¦åŠ›ãŒã¤ããƒ‰ãƒªãƒ«ã€‚</h1>
  <p class="lead">æ–‡ç« é¡Œã¯ã€Œã“ã“ã¾ã§ç¿’ã£ãŸç¯„å›²ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã€ã€‚è¨ˆç®—ã¯ã€Œæ¨ªæ–­ãƒ©ãƒ³ãƒ€ãƒ ã€ã¨ã€Œå˜å…ƒå†…ãƒ©ãƒ³ãƒ€ãƒ ã€ã€‚</p>

  <!-- å­¦å¹´ãƒ”ãƒ«ï¼ˆå…¨ä½“è¨­å®šï¼‰ -->
  <div class="topbar">
    <div class="row" style="justify-content:space-between">
      <strong>å­¦å¹´ã‚’é¸ã¶</strong>
      <span class="note">â€» ã“ã“ã§é¸ã¶ã¨å…¨ãƒ¢ãƒ¼ãƒ‰ã«é©ç”¨ï¼ˆå„ãƒ¢ãƒ¼ãƒ‰å†…ã§ä¸Šæ›¸ãå¯ï¼‰</span>
    </div>
    <div id="grade-pills" class="pills" style="margin-top:8px">
      <span data-g="" class="pill active">æœªæŒ‡å®š</span>
      <span data-g="1" class="pill">1å¹´</span>
      <span data-g="2" class="pill">2å¹´</span>
      <span data-g="3" class="pill">3å¹´</span>
      <span data-g="4" class="pill">4å¹´</span>
      <span data-g="5" class="pill">5å¹´</span>
      <span data-g="6" class="pill">6å¹´</span>
    </div>
  </div>

  <!-- ã‚¿ãƒ–ï¼šæ–‡ç« é¡Œ / è¨ˆç®— -->
  <div class="tabs">
    <div id="tab-word" class="tab active">ğŸ“˜ æ–‡ç« é¡Œ</div>
    <div id="tab-calc" class="tab">ğŸ§® è¨ˆç®—</div>
  </div>

  <div class="panels">
    <!-- æ–‡ç« é¡Œãƒ‘ãƒãƒ« -->
    <section id="panel-word" class="panel show">
      <h2>ğŸ“˜ æ–‡ç« é¡Œ</h2>
      <p class="sub">èª­ã‚€åŠ›ãƒ»è€ƒãˆã‚‹åŠ›ã‚’è‚²ã¦ã‚‹ã€ã‚µãƒ¼ãƒ“ã‚¹ã®çœ‹æ¿æ©Ÿèƒ½ã€‚</p>

      <!-- å­¦å¹´ã¯å¸¸æ™‚è¡¨ç¤º -->
      <div class="row" style="margin-bottom:8px">
        <label>å­¦å¹´
          <select id="grade-word">
            <option value="">ï¼ˆå…¨ä½“è¨­å®šã‚’ä½¿ç”¨ï¼š<span id="gg1">æœªæŒ‡å®š</span>ï¼‰</option>
            <option>1</option><option>2</option><option>3</option>
            <option>4</option><option>5</option><option>6</option>
          </select>
        </label>
        <label>å‡ºé¡Œæ•° <input type="number" id="n-word" value="5" min="1" max="20"></label>
        <button class="btn" onclick="startWordRandom()">ãƒ©ãƒ³ãƒ€ãƒ ã«å‡ºé¡Œï¼ˆãŠã™ã™ã‚ï¼‰</button>
      </div>

      <!-- è©³ç´°è¨­å®šï¼šå˜å…ƒãªã© -->
      <div id="acc-word" class="accordion">
        <div class="acc-hd" onclick="toggleAcc('acc-word')">è©³ç´°è¨­å®šï¼ˆå˜å…ƒãªã©ï¼‰</div>
        <div class="acc-bd">
          <div class="row">
            <label>å˜å…ƒï¼ˆä»»æ„ï¼‰
              <select id="unit-word">
                <option value="">æŒ‡å®šãªã—</option>
                <option value="MIX">è¤‡åˆ</option>
                <option value="SPEED">é€Ÿã•</option>
                <option value="RATE">å‰²åˆ</option>
                <option value="FRAC">åˆ†æ•°</option>
              </select>
            </label>
            <button class="btn sm" onclick="startWordByFilters()">ã“ã®æ¡ä»¶ã§å‡ºé¡Œ</button>
          </div>
          <p class="small">â€» å¾Œæ—¥ã€æ•™ç§‘æ›¸ä¼šç¤¾ã”ã¨ã®é…åˆ—ã«ã‚‚å¯¾å¿œäºˆå®šã€‚</p>
        </div>
      </div>
    </section>

    <!-- è¨ˆç®—ãƒ‘ãƒãƒ« -->
    <section id="panel-calc" class="panel">
      <h2>ğŸ§® è¨ˆç®—</h2>
      <p class="sub">ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å£ã‚’è¶Šãˆã¦ã€å¿…è¦ãªç·´ç¿’ã‚’ã¾ã¨ã‚ã¦ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã€‚</p>

      <div class="accordion acc open" id="acc-calc-cross">
        <div class="acc-hd" onclick="toggleAcc('acc-calc-cross')">æ¨ªæ–­ãƒ©ãƒ³ãƒ€ãƒ ï¼ˆã“ã‚Œã¾ã§ã®ç¯„å›²ï¼‰</div>
        <div class="acc-bd">
          <div class="row">
            <label>å­¦å¹´
              <select id="grade-calc-cross">
                <option value="">ï¼ˆå…¨ä½“è¨­å®šã‚’ä½¿ç”¨ï¼š<span id="gg2">æœªæŒ‡å®š</span>ï¼‰</option>
                <option>1</option><option>2</option><option>3</option>
                <option>4</option><option>5</option><option>6</option>
              </select>
            </label>
            <label>å‡ºé¡Œæ•° <input type="number" id="n-calc-cross" value="10" min="1" max="30"></label>
            <button class="btn sm" onclick="startCalcCross()">å‡ºé¡Œ</button>
          </div>
          <p class="small">å­¦å¹´ã«å¿œã˜ãŸç¯„å›²ã®è¨ˆç®—ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«å‡ºé¡Œã—ã¾ã™ã€‚</p>
        </div>
      </div>

      <div class="accordion acc" id="acc-calc-unit" style="margin-top:10px">
        <div class="acc-hd" onclick="toggleAcc('acc-calc-unit')">å˜å…ƒå†…ãƒ©ãƒ³ãƒ€ãƒ </div>
        <div class="acc-bd">
          <div class="row">
            <label>ç¨®åˆ¥
              <select id="calc-kind">
                <option value="add">è¶³ã—ç®—</option>
                <option value="sub">å¼•ãç®—</option>
                <option value="mul">ã‹ã‘ç®—</option>
                <option value="div">ã‚ã‚Šç®—</option>
              </select>
            </label>
            <span id="calc-options"></span>
            <label>å‡ºé¡Œæ•° <input type="number" id="n-calc-unit" value="10" min="1" max="30"></label>
            <button class="btn sm" onclick="startCalcUnit()">å‡ºé¡Œ</button>
          </div>
          <p class="small">ä¾‹ï¼‰ã‚ã‚Šç®—ã®ç­†ç®—ï¼šå•†ã®ä½ã‚„ä½™ã‚Šã®æœ‰ç„¡ã‚’ã¾ãŸã„ã§ãƒ©ãƒ³ãƒ€ãƒ ã«ã€‚</p>
        </div>
      </div>
    </section>
  </div>

  <!-- å‡ºé¡Œè¡¨ç¤º -->
  <section id="play" class="panel" style="display:none">
    <div class="row" style="justify-content:space-between">
      <div><strong id="mode-label">å‡ºé¡Œ</strong></div>
      <div class="row">
        <button class="btn ghost sm" onclick="window.print()">PDFï¼ˆå°åˆ·ï¼‰</button>
        <button class="btn ghost sm" onclick="resetAnswers()">å›ç­”ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
      </div>
    </div>
    <div id="problems"></div>
  </section>

  <p class="note">â€» ãƒ‡ãƒ¼ã‚¿ã¯æœ€å°ã‚»ãƒƒãƒˆã§å‹•ä½œã€‚å¾Œã§ <code>/app/problems.json</code> ã«æ¥ç¶šå¯èƒ½ã€‚</p>
</div>

<script>
/* â”€â”€ åŸºæœ¬UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function $(q,root=document){ return root.querySelector(q); }
function $all(q,root=document){ return Array.from(root.querySelectorAll(q)); }

function toggleAcc(id){ const el=document.getElementById(id); el.classList.toggle('open'); }

/* ã‚¿ãƒ–åˆ‡æ›¿ */
$('#tab-word').addEventListener('click', ()=>{
  $('#tab-word').classList.add('active'); $('#tab-calc').classList.remove('active');
  $('#panel-word').classList.add('show'); $('#panel-calc').classList.remove('show');
});
$('#tab-calc').addEventListener('click', ()=>{
  $('#tab-calc').classList.add('active'); $('#tab-word').classList.remove('active');
  $('#panel-calc').classList.add('show'); $('#panel-word').classList.remove('show');
});

/* å­¦å¹´ãƒ”ãƒ« â†’ å…¨ä½“è¨­å®š */
let GLOBAL_GRADE = '';
$all('#grade-pills .pill').forEach(p=>{
  p.addEventListener('click', ()=>{
    $all('#grade-pills .pill').forEach(x=>x.classList.remove('active'));
    p.classList.add('active');
    GLOBAL_GRADE = p.dataset.g || '';
    syncGlobalGradeHints();
  });
});
function syncGlobalGradeHints(){
  $('#gg1').textContent = GLOBAL_GRADE || 'æœªæŒ‡å®š';
  $('#gg2').textContent = GLOBAL_GRADE || 'æœªæŒ‡å®š';
}
syncGlobalGradeHints();

/* â”€â”€ æ–‡ç« é¡Œï¼ˆæœ€å°ãƒ‡ãƒ¼ã‚¿ï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const WORD_POOL = [
  {id:'Q-02-MIX-010-v1',grade:'2',unit:'MIX',text:'ãˆã‚“ã´ã¤ãŒ9æœ¬ã€‚3äººã«åŒã˜æœ¬æ•°ãšã¤ã‚ã‘ã‚‹ã¨1äººä½•æœ¬ï¼Ÿ',answer:'3'},
  {id:'Q-03-MIX-001-v1',grade:'3',unit:'MIX',text:'ã‚Šã‚“ã”ãŒ3ã“ã‚ã‚Šã¾ã™ã€‚ã•ã‚‰ã«4ã“ã‚‚ã‚‰ã„ã¾ã—ãŸã€‚ãœã‚“ã¶ã§ä½•ã“ï¼Ÿ',answer:'7'},
  {id:'Q-03-SPEED-012-v1',grade:'3',unit:'SPEED',text:'å®¶ã‹ã‚‰å­¦æ ¡ã¾ã§1.2kmã€‚æ¯åˆ†80mã§æ­©ãã¨ä½•åˆ†ï¼Ÿ',answer:'15'},
  {id:'Q-04-RATE-021-v1',grade:'4',unit:'RATE',text:'ã‚ã‚‹æ•°ã®25%ã¯18ã§ã™ã€‚ã‚‚ã¨ã®æ•°ã¯ã„ãã¤ï¼Ÿ',answer:'72'},
  {id:'Q-03-FRAC-030-v1',grade:'3',unit:'FRAC',text:'ã¿ã‹ã‚“ã‚’8äººã§åŒã˜æ•°ãšã¤åˆ†ã‘ã¾ã™ã€‚1äººåˆ†ã¯ä½•ã“ï¼Ÿ',answer:'1'}
];

/* å…±é€š */
const rnd = (a,b)=> Math.floor(Math.random()*(b-a+1))+a;
function pickN(arr, n){ const src=arr.slice(), out=[]; while(out.length<n && src.length){ out.push(src.splice(rnd(0,src.length-1),1)[0]); } return out; }
function getGrade(localSelId){ const v = $(localSelId)?.value || ''; return v || GLOBAL_GRADE || ''; }

/* å‡ºé¡Œï¼šæ–‡ç« é¡Œ */
function startWordRandom(){
  const g = getGrade('#grade-word');
  const n = Math.max(1, Math.min(20, Number($('#n-word').value||5)));
  let pool = WORD_POOL.slice();
  if(g) pool = pool.filter(p=>p.grade===g);
  const pick = pickN(pool, n);
  showProblems(pick.map(x=>({q:x.text, correct:x.answer, id:x.id})), 'ğŸ“˜ æ–‡ç« é¡Œï½œãƒ©ãƒ³ãƒ€ãƒ ');
}
function startWordByFilters(){
  const g = getGrade('#grade-word'); const u = $('#unit-word').value;
  const n = Math.max(1, Math.min(20, Number($('#n-word').value||5)));
  let pool = WORD_POOL.slice();
  if(g) pool = pool.filter(p=>p.grade===g);
  if(u) pool = pool.filter(p=>p.unit===u);
  const pick = pickN(pool, n);
  showProblems(pick.map(x=>({q:x.text, correct:x.answer, id:x.id})), 'ğŸ“˜ æ–‡ç« é¡Œï½œæ¡ä»¶å‡ºé¡Œ');
}

/* â”€â”€ è¨ˆç®—ï¼šæ¨ªæ–­ãƒ©ãƒ³ãƒ€ãƒ  / å˜å…ƒå†…ãƒ©ãƒ³ãƒ€ãƒ  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const CalcScopeByGrade = {
  '1': { add:true, sub:true, mul:false, div:false },
  '2': { add:true, sub:true, mul:false, div:false },
  '3': { add:true, sub:true, mul:true,  div:true  },
  '4': { add:true, sub:true, mul:true,  div:true  },
  '5': { add:true, sub:true, mul:true,  div:true  },
  '6': { add:true, sub:true, mul:true,  div:true  }
};
function allowedKindsByGrade(g){
  if(!g) return ['add','sub','mul','div'];
  const s = CalcScopeByGrade[g] || CalcScopeByGrade['6'];
  return Object.entries(s).filter(([,v])=>v).map(([k])=>k);
}
function startCalcCross(){
  const g = getGrade('#grade-calc-cross');
  const n = Math.max(1, Math.min(30, Number($('#n-calc-cross').value||10)));
  const kinds = allowedKindsByGrade(g);
  const out=[]; for(let i=0;i<n;i++){ const k = kinds[rnd(0,kinds.length-1)]; out.push(generateCalc(k, {grade:g, cross:true})); }
  showProblems(out, `ğŸ§® è¨ˆç®—ï½œæ¨ªæ–­ãƒ©ãƒ³ãƒ€ãƒ ${g?`ï¼ˆ${g}å¹´ã¾ã§ï¼‰`:''}`);
}

/* å˜å…ƒå†…ã‚ªãƒ—ã‚·ãƒ§ãƒ³UI */
const UNIT_OPTION_TEMPLATES = {
  add(){ return `
    <label>æ¡ <select id="opt-digits"><option>1æ¡</option><option selected>2æ¡</option><option>3æ¡</option></select></label>
    <label>ç¹°ã‚Šä¸ŠãŒã‚Š <select id="opt-carry"><option>ä¸å•</option><option>ã‚ã‚Š</option><option>ãªã—</option></select></label>
  `},
  sub(){ return `
    <label>æ¡ <select id="opt-digits"><option>1æ¡</option><option selected>2æ¡</option><option>3æ¡</option></select></label>
    <label>ç¹°ä¸‹ãŒã‚Š <select id="opt-borrow"><option>ä¸å•</option><option>ã‚ã‚Š</option><option>ãªã—</option></select></label>
  `},
  mul(){ return `
    <label>å½¢å¼ <select id="opt-form"><option>1æ¡Ã—1æ¡</option><option selected>2æ¡Ã—1æ¡</option><option>2æ¡Ã—2æ¡</option></select></label>
  `},
  div(){ return `
    <label>å½¢å¼ <select id="opt-form"><option selected>2æ¡Ã·1æ¡</option><option>3æ¡Ã·1æ¡</option></select></label>
    <label>ä½™ã‚Š <select id="opt-rem"><option>ä¸å•</option><option>ã‚ã‚Š</option><option>ãªã—</option></select></label>
  `}
};
function renderUnitOptions(){
  const kind = $('#calc-kind').value;
  $('#calc-options').innerHTML = UNIT_OPTION_TEMPLATES[kind]();
}
$('#calc-kind').addEventListener('change', renderUnitOptions);
renderUnitOptions();

function startCalcUnit(){
  const kind = $('#calc-kind').value;
  const n = Math.max(1, Math.min(30, Number($('#n-calc-unit').value||10)));
  const opts = {};
  if(kind==='add' || kind==='sub'){ opts.digits = $('#opt-digits').value; }
  if(kind==='add'){ opts.carry = $('#opt-carry').value; }
  if(kind==='sub'){ opts.borrow = $('#opt-borrow').value; }
  if(kind==='mul' || kind==='div'){ opts.form = $('#opt-form').value; }
  if(kind==='div'){ opts.rem = $('#opt-rem').value; }
  const out=[]; for(let i=0;i<n;i++) out.push(generateCalc(kind, opts));
  const labelMap = {add:'è¶³ã—ç®—', sub:'å¼•ãç®—', mul:'ã‹ã‘ç®—', div:'ã‚ã‚Šç®—'};
  showProblems(out, `ğŸ§® è¨ˆç®—ï½œå˜å…ƒå†…ãƒ©ãƒ³ãƒ€ãƒ ï¼ˆ${labelMap[kind]}ï¼‰`);
}

/* è¨ˆç®—ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ï¼ˆæœ€å°ï¼‰ */
function generateCalc(kind, opts={}){
  let q='', correct='';
  if(kind==='add'){
    const d = opts.digits||['1æ¡','2æ¡','3æ¡'][rnd(0,2)];
    const base = d==='1æ¡'?9 : d==='2æ¡'?99 : 999;
    let a=rnd(1,base), b=rnd(1,base);
    if(opts.carry==='ã‚ã‚Š'){ a=(a-a%10)+rnd(6,9); b=(b-b%10)+rnd(6,9); }
    if(opts.carry==='ãªã—'){ const da=rnd(1,9), db=rnd(0,9-da); a=(a-a%10)+da; b=(b-b%10)+db; }
    q = `${a}ï¼‹${b} ã‚’è¨ˆç®—ã—ã¾ã—ã‚‡ã†ã€‚`; correct = String(a+b);
  }
  if(kind==='sub'){
    const d = opts.digits||['1æ¡','2æ¡','3æ¡'][rnd(0,2)];
    const base = d==='1æ¡'?9 : d==='2æ¡'?99 : 999;
    let a=rnd(1,base), b=rnd(1,base); if(a<b){ const t=a;a=b;b=t; }
    if(opts.borrow==='ã‚ã‚Š'){ const da=rnd(0,8), db=rnd(da+1,9); a=(a-a%10)+da+10; b=(b-b%10)+db; }
    if(opts.borrow==='ãªã—'){ const da=rnd(2,9), db=rnd(0,da); a=(a-a%10)+da; b=(b-b%10)+db; }
    q = `${a}âˆ’${b} ã‚’è¨ˆç®—ã—ã¾ã—ã‚‡ã†ã€‚`; correct = String(a-b);
  }
  if(kind==='mul'){
    const form = opts.form||['1æ¡Ã—1æ¡','2æ¡Ã—1æ¡','2æ¡Ã—2æ¡'][rnd(0,2)];
    let a,b; if(form==='1æ¡Ã—1æ¡'){ a=rnd(2,9); b=rnd(2,9); }
    if(form==='2æ¡Ã—1æ¡'){ a=rnd(12,99); b=rnd(2,9); }
    if(form==='2æ¡Ã—2æ¡'){ a=rnd(12,99); b=rnd(12,99); }
    q = `${a}Ã—${b} ã‚’è¨ˆç®—ã—ã¾ã—ã‚‡ã†ã€‚`; correct = String(a*b);
  }
  if(kind==='div'){
    const form = opts.form||['2æ¡Ã·1æ¡','3æ¡Ã·1æ¡'][rnd(0,1)];
    let a,b; if(form==='2æ¡Ã·1æ¡'){ b=rnd(2,9); const qv=rnd(2,9); a=b*qv + (opts.rem==='ã‚ã‚Š'? rnd(1,b-1):0); if(opts.rem==='ãªã—') a=b*qv; }
    if(form==='3æ¡Ã·1æ¡'){ b=rnd(2,9); const qv=rnd(10,99); a=b*qv + (opts.rem==='ã‚ã‚Š'? rnd(1,b-1):0); if(opts.rem==='ãªã—') a=b*qv; }
    const qv = Math.floor(a/b), r = a%b; q = `${a}Ã·${b} ã‚’è¨ˆç®—ã—ã¾ã—ã‚‡ã†ã€‚`; correct = r? `${qv}ã‚ã¾ã‚Š${r}` : String(qv);
  }
  return {id:`GEN-${kind}-${Date.now()}-${Math.random().toString(36).slice(2,6)}`, q, correct};
}

/* å‡ºé¡Œè¡¨ç¤ºãƒ»æ¡ç‚¹ */
let CURRENT=[];
function norm(s){ return String(s||'').trim().replace(/\s+/g,''); }
function showProblems(items, label){
  CURRENT = items.map(p => ({...p, answer:null, ok:null}));
  $('#mode-label').textContent = label;
  $('#play').style.display='block';
  renderProblems();
}
function renderProblems(){
  const box = $('#problems');
  if(!CURRENT.length){ box.innerHTML='<div class="note">ã¾ã å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>'; return; }
  box.innerHTML = CURRENT.map((it,i)=>`
    <div class="q">
      <div><strong>${i+1}. ${it.q}</strong></div>
      <div class="row" style="margin-top:6px">
        <input class="answer" placeholder="ã“ãŸãˆ" data-i="${i}">
        <button class="btn sm ghost" onclick="gradeOne(${i})">åˆ¤å®š</button>
        <span id="r${i}" class="small"></span>
      </div>
    </div>
  `).join('');
  $all('.answer').forEach(inp=>{
    inp.addEventListener('keydown',e=>{ if(e.key==='Enter') gradeOne(Number(inp.dataset.i)); });
  });
}
function gradeOne(i){
  const inp = document.querySelector(`.answer[data-i="${i}"]`); const a = norm(inp.value);
  const corr = norm(CURRENT[i].correct || CURRENT[i].answer);
  const ok = (a===corr) || (a===String(Number(corr)));
  CURRENT[i].ok = ok;
  const el = document.getElementById('r'+i);
  el.textContent = ok? 'â—¯ æ­£è§£ï¼':'Ã— ã‚‚ã†ä¸€åº¦';
  el.style.color = ok? '#16a34a':'#dc2626';
}
function resetAnswers(){ CURRENT.forEach(x=>{x.answer=null;x.ok=null}); renderProblems(); alert('å›ç­”ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ'); }
</script>
</body>
</html>
